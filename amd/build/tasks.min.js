define(["jquery","core/config","core/log"],function(a,b,c){function d(){a.ajax({url:b.wwwroot+"/mod/topomojo/getresults.php",dataType:"json",type:"POST",data:{sesskey:b.sesskey,time:a.now(),id:f,cmid:i,a:h},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(b){console.log(b),index=0,a.each(b.parsed,function(a,b){var c=document.getElementsByClassName("result")[a];c&&b.status&&(c.innerHTML=b.status);var d=document.getElementsByClassName("score")[a];d&&"undefined"!=typeof b.taskscore&&(d.innerHTML=b.taskscore),a++});var c=document.getElementById("attempt-score");c&&(c.innerHTML=b.score)},error:function(a){console.log("error"),console.log(a)}})}function e(d){console.log("exec task for "+d),a.ajax({url:b.wwwroot+"/mod/topomojo/runtask.php",dataType:"json",type:"POST",data:{sesskey:b.sesskey,time:a.now(),id:d,a:h,cmid:i},headers:{"Cache-Control":"no-cache",Expires:"-1"},success:function(a){console.log(a);var b=document.getElementById("attempt-score");b&&(b.innerHTML=a.score)},error:function(a){console.log("topomojo task failed"),console.log(a),c.debug("moodle-mod_topomojo-runtask: ".request)}})}var f,g,h,i;return{init:function(b){console.log("scenario id "+b.scenario),f=b.scenario,h=b.attempt,i=b.cmid,d(),g=setInterval(function(){d()},5e3);var c=document.getElementsByClassName("exec-task");a.each(c,function(a,b){var c=b.id,d=document.getElementById(c);d&&"Run Task"===d.innerHTML&&(d.onclick=function(){e(c)},console.log("set event for button "+c))})}}});