define(["jquery"],function(a){function b(){k?(console.log("event id "+k),a.ajax({url:m+"/events/"+k,type:"GET",contentType:"application/json",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+i)},success:function(b){a.each(b,function(a,b){"viewId"==a&&b&&(l=b,console.log("view_id "+l)),"status"==a&&(console.log("status "+j),"Active"==b&&(clearTimeout(h),"Active"!=j&&"Active"==b&&(console.log("reloading"),window.location.replace(window.location.href))),"Creating"!=b&&"Planning"!=b&&"Applying"!=b&&"Ending"!=b||c(),"Ended"==b&&window.location.replace(window.location.href),"Failed"==b&&(e(),clearTimeout(h)),j=b),"scenarioid"==a&&console.log("scenario id "+b)})},error:function(a){"401"==a.status&&(console.log("permission error, check token"),clearTimeout(h),window.location.replace(window.location.href))}})):d()}function c(){var a=document.getElementById("launch_button");a.style.display="none";var a=document.getElementById("end_button");a.style.display="none";var a=document.getElementById("wait");a.style.display="block";var a=document.getElementById("vm_or_link");a.style.display="none";var a=document.getElementById("failed");a.style.display="none";var a=document.getElementById("topomojo-container");a.style.display="none";var a=document.getElementById("enable-fullscreen");a.style.display="none"}function d(){var a=document.getElementById("launch_button");a.style.display="block";var a=document.getElementById("end_button");a.style.display="none";var a=document.getElementById("wait");a.style.display="none";var a=document.getElementById("vm_or_link");a.style.display="none";var a=document.getElementById("failed");a.style.display="none";var a=document.getElementById("timerdiv");a&&(a.style.display="none");var a=document.getElementById("topomojo-container");a.style.display="none";var a=document.getElementById("enable-fullscreen");a.style.display="none"}function e(){var a=document.getElementById("launch_button");a.style.display="none";var a=document.getElementById("end_button");a.style.display="none";var a=document.getElementById("wait");a.style.display="none";var a=document.getElementById("vm_or_link");a.style.display="none";var a=document.getElementById("failed");a.style.display="block";var a=document.getElementById("topomojo-container");a.style.display="none";var a=document.getElementById("enable-fullscreen");a.style.display="none"}function f(){var a=document.getElementById("launch_button");a.style.display="none";var a=document.getElementById("end_button");a.style.display="block";var a=document.getElementById("event");a.style.value=k;var a=document.getElementById("wait");a.style.display="none";var a=document.getElementById("failed");a.style.display="none";var a=document.getElementById("vm_or_link");null!==a.getAttribute("src")&&a.setAttribute("src",n+"/views/"+l),a.getAttribute("href")&&a.setAttribute("href",o+"/view-player/"+l),a.style.display="block";var a=document.getElementById("timerdiv");a&&(a.style.display="block");var a=document.getElementById("topomojo-container");a.style.display="block";var a=document.getElementById("enable-fullscreen");a.style.display="inline-block"}function g(){h=setTimeout(function(){b(),g(),"Ended"==j&&console.log("lab has ended")},5e3)}var h,i,j,k,l,m,n,o;return{init:function(a){i=a.token,j=a.state,k=a.event,l=a.view,m=a.alloy_api_url,n=a.vm_app_url,o=a.player_app_url,"Active"==j?f():""==j?d():c();var b=document.getElementById("enable-fullscreen");b&&(b.onclick=function(){var a=document.getElementById("vm_or_link");a.requestFullscreen()}),g()}}});